# Plan: Deprecate Old Notification System, Migrate to cosa-voice MCP

**Created**: 2026.01.05 - Session 37
**Status**: READY FOR EXECUTION

---

## cosa-voice MCP Tools (v0.2.0)

| MCP Tool | Purpose | Replaces |
|----------|---------|----------|
| `notify()` | Fire-and-forget audio announcement | `notify-claude-async` |
| `converse()` | Open-ended blocking question (voice-to-text + text box) | `notify-claude-sync --response-type=open_ended` |
| `ask_yes_no()` | Binary yes/no decision | `notify-claude-sync --response-type=yes_no` |
| `ask_multiple_choice()` | Multiple-choice wizard (mirrors AskUserQuestion) | `notify-claude-sync` with menu options |
| `get_session_info()` | Session metadata (project, sender_id, etc.) | N/A |

**Key Simplifications**:
- No `[PREFIX]` needed in messages - project auto-detected from cwd
- No `--target-user=` parameter - handled internally
- No bash commands - native MCP tool calls
- Direct 1:1 compatibility with Claude Code's AskUserQuestion format

---

## Summary

Remove all references to the deprecated notification system (notify-claude-async, notify-claude-sync, notify-claude) and migrate to cosa-voice MCP server.

## Scope

**Repository**: planning-is-prompting
**Affected Files**: ~20 files, 700+ notification command instances
**Approach**: Complete removal of bash-based notification system, migration to cosa-voice MCP

---

## Phase 1: Delete bin/ Directory Entirely

**Files to DELETE** (complete removal):

| File | Lines | Reason |
|------|-------|--------|
| `bin/notify-claude-async` | 80 | Replaced by cosa-voice MCP |
| `bin/notify-claude-sync` | 82 | Replaced by cosa-voice MCP |
| `bin/notify-claude` | 43 | Already deprecated wrapper |
| `bin/install.sh` | 657 | No longer needed |
| `bin/README.md` | 566 | No longer needed |

**Action**: `rm -rf bin/`

---

## Phase 2: Replace notification-system.md

**File**: `workflow/notification-system.md` (598 lines)

**Action**: Complete rewrite as `workflow/cosa-voice-integration.md`

**New Content Structure**:
```markdown
# cosa-voice MCP Integration

## Overview
Voice I/O bridge via cosa-voice MCP server v0.2.0 (replaces deprecated notify-claude commands)

## Available MCP Tools

| Tool | Purpose | Parameters |
|------|---------|------------|
| `notify()` | Fire-and-forget audio | message, notification_type, priority |
| `converse()` | Open-ended blocking | message, response_type, timeout_seconds, response_default |
| `ask_yes_no()` | Binary yes/no | question, default, timeout_seconds |
| `ask_multiple_choice()` | Menu selection (AskUserQuestion compatible) | questions (same format as Claude Code) |
| `get_session_info()` | Session metadata | (none) |

## Fire-and-Forget Notifications
Use `notify()` for progress updates, completions, and alerts.

## Blocking Decisions
- `ask_yes_no()` - Simple yes/no confirmations
- `converse()` - Open-ended questions requiring text/voice response
- `ask_multiple_choice()` - Menu selections with 2-4 options (mirrors AskUserQuestion)

## Project Auto-Detection
cosa-voice detects project from working directory:
- planning-is-prompting -> "plan"
- genie-in-the-box -> "lupin"
- No [PREFIX] needed in messages
```

---

## Phase 3: Update Workflow Files

### 3.1 session-start.md (~10 notification references)

**Changes**:
- Line 21: Replace `notify-claude-async` with cosa-voice `notify()` documentation
- Lines 72-83: Update notification system overview
- Lines 286-316: Replace ready notification bash command with MCP tool reference
- Remove all `--target-user=` parameter references
- Remove all `[SHORT_PROJECT_PREFIX]` from notification examples

**Migration Patterns**:

```markdown
# FIRE-AND-FORGET (progress, completions, alerts)
# OLD: notify-claude-async "[PLAN] Starting session..." --type=progress --priority=low --target-user=EMAIL
# NEW: cosa-voice MCP notify("Starting session...", notification_type="progress", priority="low")

# YES/NO DECISIONS
# OLD: notify-claude-sync "[PLAN] Proceed?" --response-type=yes_no --response-default=no --timeout=300
# NEW: cosa-voice MCP ask_yes_no("Proceed?", default="no", timeout_seconds=300)

# OPEN-ENDED QUESTIONS
# OLD: notify-claude-sync "[PLAN] What approach?" --response-type=open_ended --timeout=600
# NEW: cosa-voice MCP converse("What approach?", response_type="open_ended", timeout_seconds=600)

# MULTIPLE-CHOICE MENUS (mirrors AskUserQuestion format)
# OLD: notify-claude-sync "[PLAN] Choose option" + echo "[1] A [2] B [3] C"
# NEW: cosa-voice MCP ask_multiple_choice(questions=[...]) - same format as AskUserQuestion
```

### 3.2 session-end.md (~19 notification references)

**Changes**:
- All `notify-claude-async` calls: Replace with cosa-voice `notify()`
- Commit approval (lines 293-326): Replace with `ask_multiple_choice()` for [1/2/3/4] menu
- History archive decision (line 128): Replace with `ask_multiple_choice()` for [1/2/3] menu
- Remove all bash notification command examples

### 3.3 installation-wizard.md (~32 notification references)

**Changes**:
- Step 7.6 (notification script installation): **DELETE ENTIRELY** (~200 lines)
- All `notify-claude-async` calls: Replace with cosa-voice `notify()`
- Workflow catalog selection: Replace with `ask_multiple_choice()`
- Update mode selections: Replace with `ask_multiple_choice()`

### 3.4 uninstall-wizard.md (~9 notification references)

**Changes**:
- All `notify-claude-async` calls: Replace with cosa-voice `notify()`
- Blocking confirmations: Replace with `ask_yes_no()`

### 3.5 history-management.md (~6 notification references)

**Changes**:
- Replace all notification commands with cosa-voice references
- Severity-based triggering: Update to use cosa-voice priority levels

### 3.6 testing-*.md files (7 total references)

**Changes**:
- testing-baseline.md: 3 occurrences
- testing-remediation.md: 3 occurrences
- testing-harness-update.md: 1 occurrence
- All fire-and-forget, straightforward replacement

---

## Phase 4: Update Configuration Templates

### 4.1 global/CLAUDE.md (~18 notification references)

**Complete rewrite of notification section** (lines 208-430):

```markdown
## CLAUDE CODE NOTIFICATION SYSTEM

**Purpose**: Real-time voice notifications via cosa-voice MCP server (v0.2.0)

### Available MCP Tools

| Tool | Purpose | Example |
|------|---------|---------|
| `notify()` | Fire-and-forget announcement | `notify("Task complete", notification_type="progress")` |
| `ask_yes_no()` | Binary yes/no decision | `ask_yes_no("Proceed?", default="no")` |
| `converse()` | Open-ended question | `converse("What approach?", response_type="open_ended")` |
| `ask_multiple_choice()` | Menu selection (mirrors AskUserQuestion) | `ask_multiple_choice(questions=[...])` |

### Key Features
- **No [PREFIX] needed**: Project auto-detected from working directory
- **No --target-user**: Routing handled internally
- **AskUserQuestion compatible**: ask_multiple_choice() uses same format

### DEPRECATED (Removed)
- ~~notify-claude-async~~ -> `notify()`
- ~~notify-claude-sync~~ -> `ask_yes_no()`, `converse()`, or `ask_multiple_choice()`
- ~~notify-claude~~ -> Removed entirely
```

### 4.2 workflow/claude-config-global.md (~11 references)

**Same rewrite as global/CLAUDE.md** - this is the template

### 4.3 CLAUDE.md (project) (~2 references)

**Update Notification Integration section**:
```markdown
## Notification Integration

Uses cosa-voice MCP server (v0.2.0) for notifications:
- Fire-and-forget: `notify()`
- Yes/no decisions: `ask_yes_no()`
- Open-ended questions: `converse()`
- Menu selections: `ask_multiple_choice()`

See workflow/cosa-voice-integration.md for details.
```

---

## Phase 5: Update README.md

**Remove**:
- Script Installation section (lines 142-162)
- References to bin/ directory
- Links to bin/README.md

**Add**:
- Brief mention that notifications use cosa-voice MCP server
- Link to workflow/cosa-voice-integration.md

---

## Phase 6: Update INSTALLATION-GUIDE.md

**Remove**:
- All notification script installation references (lines 1628-1630)
- Step 7.6 references to bin/install.sh
- COSA dependency documentation for notifications

---

## Files Summary

### DELETE (5 files, ~1,428 lines)
- `bin/notify-claude-async`
- `bin/notify-claude-sync`
- `bin/notify-claude`
- `bin/install.sh`
- `bin/README.md`

### CREATE (1 file)
- `workflow/cosa-voice-integration.md` (new canonical doc)

### MAJOR REWRITE (2 files)
- `workflow/notification-system.md` -> `workflow/cosa-voice-integration.md`
- `global/CLAUDE.md` notification section

### MODIFY (12 files)
- `workflow/session-start.md`
- `workflow/session-end.md`
- `workflow/installation-wizard.md`
- `workflow/uninstall-wizard.md`
- `workflow/history-management.md`
- `workflow/testing-baseline.md`
- `workflow/testing-remediation.md`
- `workflow/testing-harness-update.md`
- `workflow/claude-config-global.md`
- `workflow/INSTALLATION-GUIDE.md`
- `CLAUDE.md`
- `README.md`

### PRESERVE AS-IS (1 file)
- `history.md` - Historical record, leave notification references intact

---

## Verification Checklist (Post-Implementation)

After migration complete:
- [ ] Test `notify()` in session-start workflow
- [ ] Test `ask_multiple_choice()` in session-end commit approval
- [ ] Test `ask_yes_no()` in uninstall-wizard confirmations
- [ ] Verify project auto-detection works (no [PLAN] prefix needed)
- [ ] Grep for remaining deprecated command references

---

## Execution Order

1. Delete `bin/` directory
2. Create `workflow/cosa-voice-integration.md`
3. Update `global/CLAUDE.md` notification section
4. Update `workflow/claude-config-global.md`
5. Update core workflows (session-start, session-end)
6. Update supporting workflows (installation-wizard, uninstall-wizard, history-management)
7. Update testing workflows
8. Update CLAUDE.md (project)
9. Update README.md
10. Update INSTALLATION-GUIDE.md
11. Delete obsolete `workflow/notification-system.md`
12. Update history.md with session summary
13. Commit changes

---

## Key Simplifications

1. **No more [PREFIX] in messages**: cosa-voice auto-detects project
2. **No more --target-user parameter**: cosa-voice handles routing
3. **No more bash script installation**: MCP already registered
4. **No more COSA_CLI_PATH env var**: MCP handles internally
5. **Simpler documentation**: One tool (notify) for fire-and-forget vs 3-parameter bash command
